/*! Copyright (c) 2013 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.1.3
 *
 * Requires: 1.2.2+
 */
(function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)})(function(f){function c(q){var j,k=q||window.event,v=[].slice.call(arguments,1),m=0,p=0,o=0,e=0,n=0;return q=f.event.fix(k),q.type="mousewheel",k.wheelDelta&&(m=k.wheelDelta),k.detail&&(m=-1*k.detail),k.deltaY&&(o=-1*k.deltaY,m=o),k.deltaX&&(p=k.deltaX,m=-1*p),void 0!==k.wheelDeltaY&&(o=k.wheelDeltaY),void 0!==k.wheelDeltaX&&(p=-1*k.wheelDeltaX),e=Math.abs(m),(!g||g>e)&&(g=e),n=Math.max(Math.abs(o),Math.abs(p)),(!h||h>n)&&(h=n),j=m>0?"floor":"ceil",m=Math[j](m/g),p=Math[j](p/h),o=Math[j](o/h),v.unshift(q,m,p,o),(f.event.dispatch||f.event.handle).apply(this,v)}var g,h,a=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],b="onwheel" in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(f.event.fixHooks){for(var d=a.length;d;){f.event.fixHooks[a[--d]]=f.event.mouseHooks}}f.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=b.length;i;){this.addEventListener(b[--i],c,!1)}}else{this.onmousewheel=c}},teardown:function(){if(this.removeEventListener){for(var i=b.length;i;){this.removeEventListener(b[--i],c,!1)}}else{this.onmousewheel=null}}},f.fn.extend({mousewheel:function(i){return i?this.bind("mousewheel",i):this.trigger("mousewheel")},unmousewheel:function(i){return this.unbind("mousewheel",i)}})});(function TaxonomyBrowser(){var h=200;var b="/taxonomy/json/";var p="/browse/";var u={};var m=[];var H=null;var c=null;var v=null;var r=null;function d(J){E(J);if((typeof(u[J])!="undefined")){return u[J]}else{return[]}}function C(K,L){if(L<=(m.length-1)){o(L)}else{}if(typeof(u[K])=="undefined"){}var J=d(K);m.push(K);I(K,J)}function I(L,J){y();x(L,J);var K=$(".levels-position").position().left;var N=$(".levels-position .level").length;var O=Math.abs(K/r);var M=N-(3)-O;if((M>0)){k("-="+(r*M))}}function x(L,K){function M(O){var N=$.map(O,function(P){return{name:P,hasChild:(u[P].length>0),link:G(P)}});return N}var J=j({items:M(K),level:m.length,view_all_link:G(L)});$(".levels-position").append(J);w($(".level").last())}function y(){function K(L){var M=$.map(L,function(O,N){return{label:O,level:N}});M.shift();return M}var J=B({items:K(m)});$(".breadcrumb").replaceWith(J)}function n(L){var M=$(L.target);if(M.hasClass("no-children")){return true}L.preventDefault();var J=M.data("level");C(e(M),J);var K=M.closest(".level");K.find("a").removeClass("active");M.addClass("active")}function q(L){var M=$(L.target);L.preventDefault();var J=M.data("level");var K=(J>=2)?((J-2)*-r):0;k(K);o(J+1);y();w($(".level").last())}function a(K){K.preventDefault();var L=$(K.target);if(!L.hasClass("active")){return false}var J=(L.hasClass("next"))?"-=":"+=";var M=J+$(".level").outerWidth(true);k(M)}function s(N){N.preventDefault();var M=$(N.target);var L=M.siblings(".level-scroll");var K=L.children("ul").height();var P=L.scrollTop();var J=800;var O=M.hasClass("up")?P:K-P;J=Math.round(O*J/K);L.animate({scrollTop:M.hasClass("up")?0:K},J)}function f(L){L.preventDefault();var K=$(L.target);var J=K.siblings(".level-scroll");J.stop()}function t(N,P,L,J){N.preventDefault();var M=Math[(J<0?"floor":"ceil")](J/60);var K=M*10;var O=$(this).scrollTop();$(this).scrollTop(O-K)}function k(J){$(".levels-position").stop().animate({left:J},h,i)}function i(){var K=$(".levels-position").position().left;var M=$(".levels-position .level").length;var O=Math.abs(K/r);var L=M-3-O;var N=H.find(".prev");var J=H.find(".next");if(O>0){N.show().addClass("active")}else{N.hide().removeClass("active")}if(L>0){J.show().addClass("active")}else{J.hide().removeClass("active")}}function F(K,J){clearTimeout(v);K.removeClass("level-active-over");if((K.data("level")<=m.length)||(J&&(J.data("level")<K.data("level")))){K.removeClass("level-active");K.addClass("level-selection")}c=null;var L=$(".level").last();if(!J&&(K!==L)){w(L)}}function w(J){clearTimeout(v);if(c!==null&&(c.data("level")!==J.data("level"))){F(c,J)}J.removeClass("level-selection");J.addClass("level-active level-active-over");c=J}function g(){var J=['<div id="taxonomy-browser" class="areas">','<div class="wrapper">','<p class="breadcrumb"></p>','<div class="levels">','<div class="levels-container cf">','<div class="levels-position"></div>',"</div>",'<a href="#" class="prev"></a>','<a href="#" class="next active"></a>',"</div>","</div>","</div>"];$("#pagehdr-wrap").after(J.join("\n"))}function j(L){var K=$.map(L.items,function(N,M){return["<li>",'<a href="'+N.link+'"'+(N.hasChild?"":' class="no-children"')+' data-level="'+L.level+'">',N.name,"</a>","</li>"].join("\n")
});var J=['<div class="level" data-level="'+L.level+'">','<div class="level-scroll">',"<ul>",'<li><a href="'+L.view_all_link+'" class="no-children">View All Articles</a></li>',K.join("\n"),"</ul>","</div>",'<a href="#" class="up"></a>','<a href="#" class="down"></a>',"</div>"].join("\n");return J}function B(L){var J=$.map(L.items,function(N,M){return['<span class="level'+N.level+'">','<a href="'+G(N.label)+'" data-level="'+N.level+'">'+N.label+"</a>",(((M+1)<L.items.length)?" / ":""),"</span>"].join("\n")});var K=['<p class="breadcrumb">',"<strong>Browse Subject Areas:</strong>",J.join("\n"),"</p>"].join("\n");return K}function l(K){var J=$.extend([],m);if((typeof(K)!=="undefined")&&(K!=="/")){J.push(K)}J.shift();return b+encodeURIComponent(J.join("/"))+"&journal="+$("meta[name=currentJournal]").attr("content")}function G(K){var J=p;if((typeof(K)!=="undefined")&&(K!=="/")){J=J+encodeURIComponent(K.replace(new RegExp("\\s","g"),"_").toLowerCase())}return J}function e(J){return $.trim(J.html())}function E(L){function J(N,P,O){var M=$.map(N.categories,function(R,Q){if(R.length>0){u[Q]=R}else{u[Q]=[]}return Q});u[L]=M.sort()}function K(M,O,N){console.log("JSON load unsuccessful");$("#mn-01 a").unbind("click",A);$("#mn-01 a").attr("title","Error: No subject terms available!");$("#mn-01 a").addClass("disabled");$("#mn-01 a").on("click",function(P){P.preventDefault();return false})}$.ajax({url:l(L),type:"GET",dataType:"json",async:false}).then(J,K);return true}function o(J){while($(".levels .level").length>J){$(".levels .level").last().remove();m.pop()}}function D(K){if($tb.queue().length>0){return}K=K||false;var J=$tb.is(":hidden");if(K||!J){if(!J){$tb.slideUp();$("#searchStripForm").slideDown()}}else{$tb.slideDown();$("#searchStripForm").slideUp()}}function A(J){J.preventDefault();J.stopPropagation();D()}function z(){$(".level-active").hover(function(){$(this).addClass("level-active-over")},function(){$(this).removeClass("level-active-over")});$("#mn-01 a").on("click",A);$(document).bind("click",function(K){D(true)});$tb.click(function(K){K.stopPropagation()});var J=$(".levels-position");if(!(("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch)){J.on("mouseenter",".level",function(K){w($(K.currentTarget))});J.on("mouseleave",".level",function(K){v=setTimeout(function(){F($(K.currentTarget))},500)});J.on("mousedown",".level > a",s);J.on("mouseup",".level > a",f)}J.on("mousewheel",".level-scroll",t);J.on("click",".level > a",function(K){K.preventDefault()});J.on("click","ul li a",n);$(".wrapper").on("click",".breadcrumb a",q);H.on("click",".prev",a);H.on("click",".next",a)}$(document).ready(function(){g();H=$(".levels");$tb=$("#taxonomy-browser");z();C("/",0);r=$(".levels-position .level").outerWidth(true)})})();