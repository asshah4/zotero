$.fn.alm=function(){this.almHost=$("meta[name=almHost]").attr("content");this.almAPIKey=$("meta[name=almAPIKey]").attr("content");if(!this.almHost){this.almHost="ALM_HOST_NOT_CONFIGURED"}if(!this.almAPIKey){this.almAPIKey="ALM_KEY_NOT_CONFIGURED"}this.isNewArticle=function(d){var c=(new Date()).getTime()-172800000;if(c<d){return true}else{return false}};this.isArticle=function(c){if(c.indexOf("image")>-1){return false}return true};this.validateDOI=function(c){if(c==null){throw new Error("DOI is null.")}c=encodeURI(c);return c.replace(new RegExp("/","g"),"%2F").replace(new RegExp(":","g"),"%3A")};this.getCitesTwitterOnly=function(d,f,c){d=this.validateDOI(d);var e=d+"&source=twitter&info=event";this.getData(e,f,c)};this.getArticleSummaries=function(f,e,c){idString="";idString+=this.validateDOI(f[0]);for(a=1;a<f.length;a++){idString+=","+this.validateDOI(f[a])}var d=idString;this.getData(d,e,c)};this.sortByYearMonth=function(c,d){if(parseInt(c.year)<parseInt(d.year)){return -1}else{if(parseInt(c.year)==parseInt(d.year)){if(parseInt(c.month)==parseInt(d.month)){return 0}else{if(parseInt(c.month)<parseInt(d.month)){return -1}else{return 1}}}else{return 1}}};this.massageChartData=function(d,k){var q=new Date(k);var f=q.getFullYear();var c=q.getMonth()+1;var e=null;var m=null;var j={};for(var x=0;x<d.length;x++){if(d[x].name.toLowerCase()=="counter"){e=d[x].events;e=e.sort(this.sortByYearMonth)}if(d[x].name.toLowerCase()=="pmc"){if(d[x].events&&d[x].events.length>0){m=d[x].events;m=m.sort(this.sortByYearMonth)}}if(d[x].name.toLowerCase().toLowerCase()=="relativemetric"){if(d[x].events!=null){j.relativeMetricData=d[x].events}}}j.totalPDF=0;j.totalXML=0;j.totalHTML=0;j.total=0;j.history={};for(var x=0;x<e.length;x++){if(e[x].year<f||(e[x].year==f&&e[x].month<c)){e.splice(x,1);x--}}var i=0;var s=0;var o=0;var v=0;for(var x=0;x<e.length;x++){var p=e[x];var w=this.parseIntSafe(p.html_views)+this.parseIntSafe(p.xml_views)+this.parseIntSafe(p.pdf_views);var l=this.getYearMonth(p.year,p.month);j.history[l]={};j.history[l].source={};j.history[l].year=p.year;j.history[l].month=p.month;j.history[l].source.counterViews={};j.history[l].source.counterViews.month=p.month;j.history[l].source.counterViews.year=p.year;j.history[l].source.counterViews.totalPDF=this.parseIntSafe(p.pdf_views);j.history[l].source.counterViews.totalXML=this.parseIntSafe(p.xml_views);j.history[l].source.counterViews.totalHTML=this.parseIntSafe(p.html_views);j.history[l].source.counterViews.total=w;i+=this.parseIntSafe(p.pdf_views);s+=this.parseIntSafe(p.xml_views);o+=this.parseIntSafe(p.html_views);v+=w;j.history[l].source.counterViews.cumulativePDF=i;j.history[l].source.counterViews.cumulativeXML=s;j.history[l].source.counterViews.cumulativeHTML=o;j.history[l].source.counterViews.cumulativeTotal=v;j.history[l].cumulativeTotal=this.parseIntSafe(j.total)+w;j.history[l].cumulativePDF=j.totalPDF+this.parseIntSafe(p.pdf_views);j.history[l].cumulativeXML=j.totalXML+this.parseIntSafe(p.xml_views);j.history[l].cumulativeHTML=j.totalHTML+this.parseIntSafe(p.html_views);j.history[l].total=w;j.totalPDF+=this.parseIntSafe(p.pdf_views);j.totalXML+=this.parseIntSafe(p.xml_views);j.totalHTML+=this.parseIntSafe(p.html_views);j.total+=w}j.totalCounterPDF=i;j.totalCounterXML=s;j.totalCounterHTML=o;j.totalCouterTotal=v;var r=0;var u=0;var g=0;if(m!=null){for(var x=0;x<m.length;x++){var p=m[x];var w=this.parseIntSafe(p["full-text"])+this.parseIntSafe(p.pdf);r+=this.parseIntSafe(p.pdf);u+=this.parseIntSafe(p["full-text"]);g+=w;var l=this.getYearMonth(p.year,p.month);if(j.history[l]==null){continue}j.history[l].source.pmcViews={};j.history[l].source.pmcViews.month=p.month;j.history[l].source.pmcViews.year=p.year;j.history[l].source.pmcViews.cumulativePDF=r;j.history[l].source.pmcViews.cumulativeHTML=u;j.history[l].source.pmcViews.cumulativeTotal=g;j.history[l].source.pmcViews.totalPDF=this.parseIntSafe(p.pdf);j.history[l].source.pmcViews.totalXML="n.a.";j.history[l].source.pmcViews.totalHTML=this.parseIntSafe(p["full-text"]);j.history[l].source.pmcViews.total=w;j.history[l].total+=w;j.history[l].cumulativeTotal+=w;j.history[l].cumulativePDF+=this.parseIntSafe(p.pdf);j.history[l].cumulativeHTML+=this.parseIntSafe(p["full-text"]);j.totalPDF+=this.parseIntSafe(p.pdf);j.totalHTML+=this.parseIntSafe(p["full-text"]);j.total+=w}}j.totalPMCPDF=r;j.totalPMCHTML=u;j.totalPMCTotal=g;for(year=f;year<=(new Date().getFullYear());year++){var t=(year==f)?c:1;for(month=t;month<13;month++){if(year==(new Date().getFullYear())&&(month-1)>(new Date().getMonth())){break}l=this.getYearMonth(year,month);if(j.history[l]!=null&&j.history[l].source.pmcViews==null){j.history[l].source.pmcViews={};j.history[l].source.pmcViews.month=month+1;j.history[l].source.pmcViews.year=year;j.history[l].source.pmcViews.cumulativePDF=0;j.history[l].source.pmcViews.cumulativeHTML=0;j.history[l].source.pmcViews.cumulativeTotal=0;j.history[l].source.pmcViews.totalPDF=0;j.history[l].source.pmcViews.totalXML=0;j.history[l].source.pmcViews.totalHTML=0;
j.history[l].source.pmcViews.total=0;var y=0;var h=0;if(month==1){y=12;h=year-1}else{y=month-1;h=year}var n=this.getYearMonth(h,y);if(j.history[n]!=null&&j.history[n].source.pmcViews!=null){j.history[l].source.pmcViews.cumulativePDF=j.history[n].source.pmcViews.cumulativePDF;j.history[l].source.pmcViews.cumulativeHTML=j.history[n].source.pmcViews.cumulativeHTML;j.history[l].source.pmcViews.cumulativeTotal=j.history[n].source.pmcViews.cumulativeTotal;j.history[l].source.pmcViews.totalPDF=0;j.history[l].source.pmcViews.totalHTML=0;j.history[l].source.pmcViews.total=0}else{j.history[l].source.pmcViews.cumulativePDF=0;j.history[l].source.pmcViews.cumulativeHTML=0;j.history[l].source.pmcViews.cumulativeTotal=0;j.history[l].source.pmcViews.totalPDF=0;j.history[l].source.pmcViews.totalHTML=0;j.history[l].source.pmcViews.total=0}}}}if(j.totalPMCTotal==0){j.totalPMCPDF=0;j.totalPMCHTML=0;j.totalPMCTotal=0}return j};this.parseIntSafe=function(c){if(isNaN(c)){return 0}return parseInt(c)};this.getYearMonth=function(c,d){if(this.parseIntSafe(d)<10){return c+"-0"+d}else{return c+"-"+d}};this.setCrossRefText=function(c,h,f,d){var e=function(i){var j=$("#"+f);j.html("Citations are currently not available, please check back later.");j.show("blind",500);$("#"+d).fadeOut("slow")};var g=function(i){this.setCrossRefLinks(i,h);$("#"+d).fadeOut("slow")};this.getCitesCrossRefOnly(c,jQuery.proxy(g,this),e)};this.getCitesCrossRefOnly=function(d,f,c){d=this.validateDOI(d);var e=d+"&source=crossref&info=event";this.getData(e,f,c)};this.setCrossRefLinks=function(e,d){var n=encodeURIComponent(e[0].doi);var l=this.filterSources(e[0].sources,["crossref"])[0];var p=0;if(l.metrics.total>0){p=l.metrics.total;var j="";for(var c=0;c<l.events.length;c++){var m=l.events[c].event;var o=l.events[c].event_url;j=j+"<li><span class='article'><a href=\""+o+'">'+m.article_title+'</a> <span class="pubGetPDFLink" id="citation_'+this.fixDoiForID(m.doi)+'"></span></span>';if(m.contributors){var g="";var q="";var f="";var k=m.contributors.contributor;for(var h=0;h<k.length;h++){individualContributor=k[h];if(individualContributor.first_author==="true"){if(individualContributor.surname){g=individualContributor.surname;if(individualContributor.given_name&&individualContributor.given_name.length>0){g=g+" "+individualContributor.given_name.substr(0,1)}}}else{f="";if(individualContributor.surname){f=individualContributor.surname;if(individualContributor.given_name&&individualContributor.given_name.length>0){f=f+" "+individualContributor.given_name.substr(0,1)}q=q+", "+f}}}q=g+q;j=j+"<span class='authors'>"+q+"</span>"}j=j+"<span class='articleinfo'>";if(m.journal_title!=null){j=j+m.journal_title}if(m.year!=null){j=j+" "+m.year}if(m.volume!=null){j=j+" "+m.volume}if(m.issue!=null){j=j+"("+m.issue+")"}if(m.first_page){j=j+": "+m.first_page}j=j+". doi:"+m.doi+"</span></li>"}}if(p<1){j="<h3>No related citations found</h3>"}else{var r="";if(p!=1){r="s"}j=p+" citation"+r+' as recorded by <a href="http://www.crossref.org">CrossRef</a>.  Article published '+$.datepicker.formatDate("M dd, yy",new Date(e[0].publication_date))+". Citations updated on "+$.datepicker.formatDate("M dd, yy",new Date(e[0].update_date))+". <ol>"+j+"</ol>"}$("#"+d).html(j);$("#"+d).show("blind",500)};this.fixDoiForID=function(c){return c.replace(/\//g,":")};this.getData=function(e,f,c){var d=this.almHost+"?api_key="+this.almAPIKey+"&ids="+e;$.jsonp({url:d,context:document.body,timeout:20000,callbackParameter:"callback",success:f,error:function(h,g){c("Our system is having a bad day. We are working on it. Please check back later.")}});console.log(d)};this.setSavedSuccess=function(h,e,g){var k=$("#"+e);$("#"+g).fadeOut("slow");k.css("display","none");var d=this.filterSources(h[0].sources,["citeulike","connotea","mendeley"]);d=this.enforceOrder(d,["citeulike","connotea","mendeley"]);var i=true;for(var l=0;l<d.length;l++){var c=d[l];if(c.metrics.total>0){i=false;switch(c.name){case"mendeley":k.append(this.createMetricsTile(c.display_name,c.events_url,"/images/logo-"+c.name+".png",c.metrics.total)+"\n");var j=c.metrics.shares;var f=c.metrics.groups;$("#MendeleyImageOnArticleMetricsTab").tooltip({backgroundColor:"rgba(255, 255, 255, 0.0)",delay:250,fade:250,track:true,shadow:false,showURL:false,bodyHandler:function(){return $('<div class="tileTooltip"><table class="tile_mini"><thead><tr><th>Individuals</th><th>Groups</th></tr></thead><tbody><tr><td class="data1">'+j.format(0,".",",")+'</td><td class="data2">'+f.format(0,".",",")+"</td></tr></tbody></table></div>")}});break;case"connotea":k.append(this.createMetricsTileNoLink(c.display_name,"/images/logo-"+c.name+".png",c.metrics.total)+"\n");break;default:k.append(this.createMetricsTile(c.display_name,c.events_url,"/images/logo-"+c.name+".png",c.metrics.total)+"\n");break}}}if(i){$("#socialNetworksOnArticleMetricsPage").css("display","none")}else{k.show("blind",500)}};this.setSavedError=function(d,e,c){$("#"+c).fadeOut("slow");$("#"+e).html('<img src="/images/icon_error.png"/>&nbsp;'+d);
$("#"+e).show("blind",500)};this.createMetricsTile=function(d,c,f,e){return'<div id="'+d+'OnArticleMetricsTab" class="metrics_tile"><a href="'+c+'"><img id="'+d+'ImageOnArticleMetricsTab" src="'+f+'" alt="'+e+" "+d+'" class="metrics_tile_image"/></a><div class="metrics_tile_footer" onclick="location.href=\''+c+'\';"><a href="'+c+'">'+e+"</a></div></div>"};this.createMetricsTileNoLink=function(c,e,d){return'<div id="'+c+'OnArticleMetricsTab" class="metrics_tile_no_link"><img id="'+c+'ImageOnArticleMetricsTab" src="'+e+'" alt="'+d+" "+c+'" class="metrics_tile_image"/><div class="metrics_tile_footer_no_link">'+d+"</div></div>"};this.setDiscussedSuccess=function(g,n,e){$("#"+e).fadeOut("slow");var i=$("#"+n);i.css("display","none");var h=$("meta[name=citation_title]").attr("content");var m=encodeURI($("meta[name=citation_doi]").attr("content"));var j="",d=null,p="";var c=this.filterSources(g[0].sources,["researchblogging","scienceseeker","nature","wikipedia","twitter","facebook"]);c=this.enforceOrder(c,["researchblogging","scienceseeker","nature","wikipedia","twitter","facebook"]);for(var o=0;o<c.length;o++){d=c[o];j="";if(d.metrics.total>0){if(d.name==="facebook"){j=this.createMetricsTileNoLink(d.display_name,"/images/logo-"+d.name+".png",d.metrics.total)+"\n";var f=d.metrics.likes;var l=d.metrics.shares;var k=d.metrics.comments;p='<div class="tileTooltip"><table class="tile_mini"><thead><tr><th>Likes</th><th>Shares</th><th>Posts</th></tr></thead><tbody><tr><td class="data1">'+f.format(0,".",",")+'</td><td class="data2">'+l.format(0,".",",")+'</td><td class="data1">'+k.format(0,".",",")+"</td></tr></tbody></table></div>"}else{if(d.name==="twitter"){j=this.createMetricsTile(d.display_name,"/article/twitter/info:doi/"+m,"/images/logo-"+d.name+".png",d.metrics.total)+"\n"}else{if(!d.events_url){j=this.createMetricsTileNoLink(d.display_name,"/images/logo-"+d.name+".png",d.metrics.total)+"\n"}else{j=this.createMetricsTile(d.display_name,d.events_url,"/images/logo-"+d.name+".png",d.metrics.total)+"\n"}}}if(j.length>0){i.append(j)}}}$("#notesAndCommentsOnArticleMetricsTab").appendTo(i);$("#trackbackOnArticleMetricsTab").appendTo(i);j=this.createMetricsTile("google-blogs","http://blogsearch.google.com/blogsearch?as_q=%22"+h+"%22","/images/logo-googleblogs.png","Search")+"\n";i.append(j);$("#FacebookOnArticleMetricsTab").tooltip({delay:250,fade:250,track:true,showURL:false,bodyHandler:function(){return $(p)}});i.show("blind",500)};this.setDiscussedError=function(h,c,d){var f=$("#"+c);f.css("display","none");var g=$("meta[name=citation_title]").attr("content");var e="Search for related blog posts on <a href='http://blogsearch.google.com/blogsearch?as_q=%22"+g+"%22'>Google Blogs</a><br/><img src='/images/icon_error.png'/>&nbsp;"+h;f.html(e);$("#"+d).fadeOut("slow");f.show("blind",500)};this.setCitesSuccess=function(h,f,g){$("#"+g).fadeOut("slow");$("#"+f).css("display","none");var k=0;var l=encodeURI($("meta[name=citation_doi]").attr("content"));var j="";var d=this.filterSources(h[0].sources,["crossref","pubmed","scopus","wos"]);d=this.enforceOrder(d,["scopus","crossref","pubmed","wos"]);for(var m=0;m<d.length;m++){source=d[m];if(source.metrics.total>0){var e=source.events_url;var i=/\s/g;var c=source.display_name.toLowerCase().replace(i,"-");c=c.replace("\u00ae","");if(source.name.toLowerCase()=="crossref"){j=j+this.createMetricsTile(c,"/article/crossref/info:doi/"+l,"/images/logo-"+c+".png",source.metrics.total)+"\n";k++}else{if(source.events_url){j=j+this.createMetricsTile(c,e,"/images/logo-"+c+".png",source.metrics.total)+"\n";k++}else{j=j+this.createMetricsTileNoLink(c,"/images/logo-"+c+".png",source.metrics.total)+"\n";k++}}}}var n="http://dx.plos.org/"+l.replace("info%3Adoi/","");if(k==0){j='No related citations found<br/>Search for citations in <a href="http://scholar.google.com/scholar?hl=en&lr=&cites='+n+'">Google Scholar</a>'}else{j=j+this.createMetricsTile("googleScholar","http://scholar.google.com/scholar?hl=en&lr=&cites="+n,"/images/logo-google-scholar.png","Search")}$("#"+f).html(j);$("#"+f).show("blind",500)};this.setCitesError=function(e,c,d){$("#"+d).fadeOut("slow");$("#"+c).html('<img src="/images/icon_error.png"/>&nbsp;'+e);$("#"+c).show("blind",500)};this.setF1000Success=function(g,f,e,h){var c=this.filterSources(g[0].sources,["f1000"]).pop();if(!c){return}if(c.metrics.total==0){return}var d=encodeURI($("meta[name=citation_doi]").attr("content"));$("#"+f).show("blind",500);$("#"+e).fadeOut("slow");$("#"+h).append(this.createMetricsTile(c.display_name,c.events_url,"/images/logo-"+c.name+".png",c.metrics.total)+"\n").show("blind",500)};this.setF1000Error=function(c){};this.setChartData=function(d,i,e){var c=$.datepicker.parseDate("yy/m/d",$("meta[name=citation_date]").attr("content"));publishDatems=c.getTime();if(this.isNewArticle(publishDatems)){$("#"+i).html("This article was only recently published. Although we update our data on a daily basis (not in real time), there may be a 48-hour delay before the most recent numbers are available.<br/><br/>");
$("#"+i).show("blind",500);$("#"+e).fadeOut("slow")}else{if(this.isArticle(d)){var f=function(j){$("#"+e).fadeOut("slow");$("#"+i).html('<img src="/images/icon_error.png"/>&nbsp;'+j);$("#"+i).show("blind",500)};var h=function(j){var q=$("#"+i);$("#"+e).fadeOut("slow");q.css("display","none");var E=this.massageChartData(j[0].sources,publishDatems);var w=$('<div id="pageViewsSummary"><div id="left"><div class="header">Total Article Views</div><div class="totalCount">'+E.total.format(0,".",",")+'</div><div class="pubDates">'+$.datepicker.formatDate("M d, yy",c)+" (publication date)<br>through "+$.datepicker.formatDate("M d, yy",new Date())+'*</div></div><div id="right"><table id="pageViewsTable"><tbody><tr><th></th><th nowrap="">HTML Page Views</th><th nowrap="">PDF Downloads</th><th nowrap="">XML Downloads</th><th>Totals</th></tr><tr><td class="source1">PLOS</td><td>'+E.totalCounterHTML.format(0,".",",")+"</td><td>"+E.totalCounterPDF.format(0,".",",")+"</td><td>"+E.totalCounterXML.format(0,".",",")+'</td><td class="total">'+E.totalCouterTotal.format(0,".",",")+'</td></tr><tr><td class="source2">PMC</td><td>'+E.totalPMCHTML.format(0,".",",")+"</td><td>"+E.totalPMCPDF.format(0,".",",")+'</td><td>n.a.</td><td class="total">'+E.totalPMCTotal.format(0,".",",")+'</td></tr><tr><td>Totals</td><td class="total">'+E.totalHTML.format(0,".",",")+'</td><td class="total">'+E.totalPDF.format(0,".",",")+'</td><td class="total">'+E.totalXML.format(0,".",",")+'</td><td class="total">'+E.total.format(0,".",",")+'</td></tr><tr class="percent"><td colspan="5"><b>'+((E.totalPDF/E.totalHTML)*100).format(2,".",",")+"%</b> of article views led to PDF downloads</td></tr></tbody></table></div></div>");var D=$.map(E.history,function(H,G){return G});q.append(w);var m=Object.keys(E.history).length>1;if(m){var n={chart:{renderTo:"chart",animation:false,margin:[40,40,40,80]},credits:{enabled:false},exporting:{enabled:false},title:{text:null},legend:{enabled:false},xAxis:{title:{text:"Months",style:{fontFamily:"'FS Albert Web Regular', Verdana, sans-serif",fontWeight:"normal",color:"#000"},align:"high"},labels:{step:(D.length<15)?1:Math.round(D.length/15),formatter:function(){return this.value+1}},categories:[]},yAxis:[{title:{text:"Cumulative Views",style:{fontFamily:"'FS Albert Web Regular', Verdana, sans-serif",fontWeight:"normal",color:"#000",height:"50px"}},labels:{style:{color:"#000"}}}],plotOptions:{column:{stacking:"normal"},animation:false,series:{pointPadding:0,groupPadding:0,borderWidth:0,shadow:false}},series:[{name:"PMC",type:"column",data:[],color:"#6d84bf"},{name:"PLOS",type:"column",data:[],color:"#3c63af"}],tooltip:{backgroundColor:"rgba(255, 255, 255, 0.0)",useHTML:true,shared:true,shadow:false,borderWidth:0,borderRadius:0,positioner:function(K,H,G){var J=G.plotX+(H/2)+25,I=G.plotY-(K/2)+25;return{x:J,y:I}},formatter:function(){var G=this.points[0].key,H=E.history;return'<table id="mini" cellpadding="0" cellspacing="0"><tr><th></td><td colspan="2">Views in '+$.datepicker.formatDate("M yy",new Date(H[G].year,H[G].month-1,2))+'</td><td colspan="2">Views through '+$.datepicker.formatDate("M yy",new Date(H[G].year,H[G].month-1,2))+'</td></tr><tr><th>Source</th><th class="header1">PLOS</th><th class="header2">PMC</th><th class="header1">PLOS</th><th class="header2">PMC</th></tr><tr><td>HTML</td><td class="data1">'+H[G].source.counterViews.totalHTML+'</td><td class="data2">'+(H[G].source.hasOwnProperty("pmcViews")?H[G].source.pmcViews.totalHTML.format(0,".",","):"n.a.")+'</td><td class="data1">'+H[G].source.counterViews.cumulativeHTML.format(0,".",",")+'</td><td class="data2">'+(H[G].source.hasOwnProperty("pmcViews")?H[G].source.pmcViews.cumulativeHTML.format(0,".",","):"n.a.")+'</td></tr><tr><td>PDF</td><td class="data1">'+H[G].source.counterViews.totalPDF+'</td><td class="data2">'+(H[G].source.hasOwnProperty("pmcViews")?H[G].source.pmcViews.totalPDF.format(0,".",","):"n.a.")+'</td><td class="data1">'+H[G].source.counterViews.cumulativePDF.format(0,".",",")+'</td><td class="data2">'+(H[G].source.hasOwnProperty("pmcViews")?H[G].source.pmcViews.cumulativePDF.format(0,".",","):"n.a.")+'</td></tr><tr><td>XML</td><td class="data1">'+H[G].source.counterViews.totalXML+'</td><td class="data2">n.a.</td><td class="data1">'+H[G].source.counterViews.cumulativeXML.format(0,".",",")+'</td><td class="data2">n.a.</td></tr><tr><td>Total</td><td class="data1">'+H[G].source.counterViews.total+'</td><td class="data2">'+(H[G].source.hasOwnProperty("pmcViews")?H[G].source.pmcViews.total.format(0,".",","):"n.a.")+'</td><td class="data1">'+H[G].source.counterViews.cumulativeTotal.format(0,".",",")+'</td><td class="data2">'+(H[G].source.hasOwnProperty("pmcViews")?H[G].source.pmcViews.cumulativeTotal.format(0,".",","):"n.a.")+"</td></tr></table>"}}};for(var F in E.history){if(E.history[F].source.pmcViews!=null){n.series[0].data.push({name:F,y:E.history[F].source.pmcViews.cumulativeTotal})}else{n.series[0].data.push({name:F,y:0})}n.series[1].data.push({name:F,y:E.history[F].source.counterViews.cumulativeTotal})
}q.append($('<div id="chart"></div>').css("width","600px").css("height","200px"));var t=new Highcharts.Chart(n);if(E.relativeMetricData!=null){var r=E.relativeMetricData.subject_areas;if(r&&r.length>0){var u=new Array();for(var x=0;x<r.length;x++){var o=r[x].subject_area;var z=r[x].average_usage;if(z.length>=2){u.push(o);if(z.length>D.length){z=z.slice(0,D.length)}t.addSeries({id:o,data:z,type:"line",color:"#01DF01",marker:{enabled:false,states:{hover:{enabled:false}}}});t.get(o).hide()}}if(u.length>0){var A;var B=$('<select id="subject_areas"></select>');u.sort();for(x=0;x<u.length;x++){var v=u[x].substr(1);var y=v.split("/");if(y.length==1){B.append($("<option></option>").attr("value",u[x]).text(y[0]))}else{if(y.length==2){B.append($("<option></option>").attr("value",u[x]).html("&nbsp;&nbsp;&nbsp;"+y[1]));if(A==null){A=u[x]}}}}if(A==null){A=u[0]}B.find('option[value="'+A+'"]').attr("selected","selected");t.get(A).show();B.change(function(){$("#subject_areas option").each(function(){t.get($(this).val()).hide()});t.get($(this).val()).show();var G=$('input[name="refsetLinkValue"]').val();$("#linkToRefset").attr("href",G.replace("SUBJECT_AREA",$(this).val()))});var k=$("<div></div>").html('<span class="colorbox"></span>&nbsp;Compare average usage for articles published in <b>'+new Date(E.relativeMetricData.start_date).getUTCFullYear()+'</b> in the subject area: <a href="/static/almInfo#relativeMetrics" class="ir" title="More information">info</a>');var p="/search/advanced?pageSize=12&unformattedQuery=(publication_date:["+E.relativeMetricData.start_date+" TO "+E.relativeMetricData.end_date+']) AND subject:"SUBJECT_AREA"';var s=$("<div></div>").append(B).append('&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="linkToRefset" href="'+encodeURI(p.replace("SUBJECT_AREA",A))+'" >Show reference set</a>').append('<input type="hidden" name="refsetLinkValue" value="'+encodeURI(p)+'" >');var l=$('<div id="averageViewsSummary"></div>').append(k).append(s);var C=$('<div id="beta">BETA</div>');q.append(C);q.append(l)}}}}q.append($("<p>*Although we update our data on a daily basis, there may be a 48-hour delay before the most recent numbers are available. PMC data is posted on a monthly basis and will be made available once received.</p>"));this.addFigshareTile(j[0]);q.show("blind",500)};d=this.validateDOI(d);var g=d+"&source=pmc,counter,relativemetric,figshare&info=event";this.getData(g,jQuery.proxy(h,this),f)}}};this.addFigshareTile=function(c){var d=0,g;for(d=0;d<c.sources.length;d++){g=c.sources[d];if(g.name.toLowerCase()=="figshare"){if(g.metrics.total>0){var f=g.name;var e=this.createMetricsTileNoLink(f,"/images/logo-"+f+".png",g.metrics.total);$("#views").append(e)}break}}$.ajax({url:"/article/figureTableList.action?uri=info:doi/"+c.doi,dataFilter:function(i,h){return i.replace(/(^\/\*|\*\/$)/g,"")},dataType:"json",error:function(h,j,i){console.log(i)},success:function(m){var i=$('<div class="tileTooltip"></div>'),n=$('<table class="tile_mini"></table>'),l,h,j,k={};for(d=0;d<g.events.items.length;d++){l=g.events.items[d],h=0,j="";if(l.doi.length==1){j=l.doi[0].replace("http://dx.doi.org/","")}else{if(l.doi.length>1){j="SI"}}h=l.stats.downloads+l.stats.page_views;k[j]='<td class="data1">'+h+"</td>"}for(d=0;d<m.secondaryObjects.length;d++){j=m.secondaryObjects[d].doi.replace("info:doi/","");n.append("<tr><td>"+m.secondaryObjects[d].title+"</td>"+k[j]+"</tr>")}if(k.SI){n.append("<tr><td>Supporting Info files</td>"+k.SI+"</tr>")}$("#figshareImageOnArticleMetricsTab").tooltip({delay:250,fade:250,track:true,showURL:false,bodyHandler:function(){return i.append(n)}})}})};this.makeSignPostLI=function(g,f,e,d){var c=$('<li><div class="top">'+f.format(0,".",",")+'</div><div class="bottom"><div class="center"><div class="text">'+g+'<div class="content"><div class="description">'+e+'&nbsp;&nbsp;<a href="'+d+'">Read more</a>.</div></div></div></div></div></li>');(function(){this.hoverEnhanced({})}).apply(c);return c};this.setMetricsTab=function(d){d=this.validateDOI(d);var e=function(f){this.setCitesSuccess(f,"relatedCites","relatedCitesSpinner");this.setSavedSuccess(f,"relatedBookmarks","relatedBookmarksSpinner");this.setDiscussedSuccess(f,"relatedBlogPosts","relatedBlogPostsSpinner");this.setF1000Success(f,"f1kHeader","f1KSpinner","f1kContent")};var c=function(f){this.setCitesError(f,"relatedCites","relatedCitesSpinner");this.setSavedError(f,"relatedBookmarks","relatedBookmarksSpinner");this.setDiscussedError(f,"relatedBlogPosts","relatedBlogPostsSpinner");this.setF1000Error(f,"f1000","f1000Spinner")};this.getData(d,$.proxy(e,this),$.proxy(c,this))};this.filterSources=function(d,c){validSources=[];for(var e=0;e<d.length;e++){if($.inArray(d[e].name.toLowerCase(),c)>-1){validSources.push(d[e])}}return validSources};this.enforceOrder=function(f,c){var g=[];for(var j=0;j<f.length;j++){g.push(f[j].name)}var h=[];for(var i=0;i<c.length;i++){var e=$.inArray(c[i],g);if(e>-1){h.push(f[e])}}return h}};function onReadyALM(){var f=300,h=172800000;
if($("#almSignPost").length>0){var i=new $.fn.alm(),d=$("meta[name=citation_doi]").attr("content"),c=$.datepicker.parseDate("yy/m/d",$("meta[name=citation_date]").attr("content")),j=c.getTime();var g=function(k){$("#almSignPostSpinner").css("display","none");if(j>((new Date().getTime())-h)){}else{$("#almSignPost").append($("<li></li>").text("metrics unavailable").css("vertical-align","middle"));$("#almSignPost").fadeIn(f)}};var e=function(r){if(r&&r.length>0){responseObject=r[0];var k,l,q,p,n,x,u,o;sources=responseObject.sources;for(var s=0;s<sources.length;s+=1){source=sources[s];if(source.name.toLowerCase()=="counter"){k=source}else{if(source.name.toLowerCase()=="pmc"){l=source}else{if(source.name.toLowerCase()=="scopus"){q=source}else{if(source.name.toLowerCase()=="facebook"){p=source}else{if(source.name.toLowerCase()=="twitter"){n=source}else{if(source.name.toLowerCase()=="mendeley"){x=source}else{if(source.name.toLowerCase()=="citeulike"){u=source}else{if(source.name.toLowerCase()=="crossref"){o=source}}}}}}}}}v=i.makeSignPostLI("VIEWS",k.metrics.total+l.metrics.total,"Sum of PLOS and PubMed Central page views and downloads","/static/almInfo#usageInfo");$("#almSignPost").append(v);var w,v;if(q.metrics.total>0){w="CITATIONS";if(q.metrics.total==1){w="CITATION"}v=i.makeSignPostLI(w,q.metrics.total,"Paper's citation count computed by Scopus","/static/almInfo#citationInfo");$("#almSignPost").append(v)}else{if(o.metrics.total>0){w="CITATIONS";if(o.metrics.total==1){w="CITATION"}v=i.makeSignPostLI(w,o.metrics.total,"Scopus data unavailable. Displaying Crossref citation count","/static/almInfo#citationInfo");$("#almSignPost").append(v)}}var m=x.metrics.total+u.metrics.total;if(m>0){w="SAVES";if(m==1){w="SAVE"}v=i.makeSignPostLI(w,x.metrics.total+u.metrics.total,"Total Mendeley and CiteULike bookmarks","/static/almInfo#socialBookmarks");$("#almSignPost").append(v)}var t=p.metrics.total+n.metrics.total;if(t>0){w="SHARES";if(t==1){w="SHARE"}v=i.makeSignPostLI(w,p.metrics.total+n.metrics.total,"Sum of Facebook and Twitter activity","/static/almInfo#socialBookmarks");$("#almSignPost").append(v)}$("#almSignPost").fadeIn(f)}};i.getArticleSummaries([d],e,g)}}$(document).ready(onReadyALM);function onLoadALM(){var d=new $.fn.alm();var c=$("meta[name=citation_doi]").attr("content");d.setMetricsTab(c);d.setChartData(c,"usage","chartSpinner")}function setALMSearchWidgets(k){for(a=0;a<k.length;a++){var m=k[a];var l=m.doi;var c=m.sources;var j,p,d,q,g,i,e,o,h,f;j=p=d=q=g=i=e=o=h=f=null;var n=[];for(var t=0;t<c.length;t++){n.push(c[t].name)}j=c[n.indexOf("scopus")];p=c[n.indexOf("citeulike")];o=c[n.indexOf("pubmed")];d=c[n.indexOf("counter")];q=c[n.indexOf("mendeley")];g=c[n.indexOf("crossref")];i=c[n.indexOf("wos")];e=c[n.indexOf("pmc")];h=c[n.indexOf("facebook")];f=c[n.indexOf("twitter")];var r=false;if(j.metrics.total>0||p.metrics.total>0||e.metrics.total+d.metrics.total>0||q.metrics.total>0||h.metrics.shares+f.metrics.total>0){r=true}if(r){confirmed_ids[confirmed_ids.length]=l;makeALMSearchWidget(l,j,p,d,q,g,i,e,o,h,f)}}confirmALMDataDisplayed()}function makeALMSearchWidget(l,k,o,c,p,f,h,d,n,g,e){var i=getSearchWidgetByDOI(l);var m=getMetricsURL(l);var j=$(i).fadeOut(250,function(){var q=$("<span></span>");q.addClass("almSearchWidget");buildWidgetText(q,m,k,o,c,p,f,h,d,n,g,e);$(i).html("");$(i).append(q);$(i).fadeIn(250)})}function buildWidgetText(r,q,d,o,m,j,f,h,t,c,e,l){var g=null;var u=t.metrics.total+m.metrics.total;var n=t.metrics.html+m.metrics.html;var s=t.metrics.pdf+m.metrics.pdf;var k=u-s-t.metrics.html-m.metrics.html;if(u>0){g=$("<a></a>").attr("href",q+"#usage").html("Views: "+u.format(0,".",",")).addClass("data");g.tooltip({delay:250,fade:250,top:-40,left:20,track:true,showURL:false,bodyHandler:function(){return'<span class="searchResultsTip">HTML: <b>'+n.format(0,".",",")+"</b>, PDF: <b>"+s.format(0,".",",")+"</b>, XML: <b>"+k.format(0,".",",")+"</b>, Grand Total: <b>"+u.format(0,".",",")+"</b></span>"}});r.append($("<span></span>").append(g))}else{r.appendChild($("<span></span>").addClass("no-data").html("Views: Not available"))}if(d.metrics.total>0){g=$("<a></a>").attr("href",q+"#citations").html("Citations: "+d.metrics.total.format(0,".",",")).addClass("data");g.tooltip({delay:250,fade:250,top:-40,left:20,track:true,showURL:false,bodyHandler:function(){var y=[f,c,h];var v=d.display_name+": <b>"+d.metrics.total.format(0,".",",")+"</b>";for(var w=0;w<y.length;w++){var x=y[w];if(x.metrics.total>0){v+=", "+x.display_name+": <b>"+x.metrics.total.format(0,".",",")+"</b>"}}return'<span class="searchResultsTip">'+v+"</span>"}});appendBullIfNeeded(r);r.append($("<span></span>").append(g))}else{appendBullIfNeeded(r);r.append($("<span></span>").html("Citations: None").addClass("no-data"))}var i=j.metrics.total+o.metrics.total;if(i>0){g=$("<a></a>").attr("href",q+"#other").html("Saves: "+i.format(0,".",",")).addClass("data");appendBullIfNeeded(r);g.tooltip({delay:250,fade:250,top:-40,left:20,track:true,showURL:false,bodyHandler:function(){var v="";
if(j.metrics.total>0){v+=j.display_name+": <b>"+j.metrics.total.format(0,".",",")+"</b>"}if(o.metrics.total>0){if(v!=""){v+=", "}v+=o.display_name+": <b>"+o.metrics.total.format(0,".",",")+"</b>"}return'<span class="searchResultsTip">'+v+"</span>"}});r.append($("<span></span>").append(g))}else{appendBullIfNeeded(r);r.append($("<span></span>").html("Saves: None").addClass("no-data"))}var p=e.metrics.shares+l.metrics.total;if(p>0){g=$("<a></a>").attr("href",q+"#other").html("Shares: "+p).addClass("data");appendBullIfNeeded(r);g.tooltip({delay:250,fade:250,top:-40,left:20,track:true,showURL:false,bodyHandler:function(){var v="";if(e.metrics.shares>0){v+=e.display_name+": <b>"+e.metrics.shares.format(0,".",",")+"</b>"}if(l.metrics.total>0){if(v!=""){v+=", "}v+=l.display_name+": <b>"+l.metrics.total.format(0,".",",")+"</b>"}return'<span class="searchResultsTip">'+v+"</span>"}});r.append($("<span></span>").append(g))}else{appendBullIfNeeded(r);r.append($("<span></span>").html("Shares: None").addClass("no-data"))}}function appendBullIfNeeded(c){if(c.size()>0){c.append("&nbsp;&bull;&nbsp;")}}function getSearchWidgetByDOI(c){return $("li[data-doi='"+c+"'] span.metrics")}function getMetricsURL(c){return $($("li[data-doi='"+c+"']")[0]).data("metricsurl")}function setALMSearchWidgetsError(){confirmALMDataDisplayed()}function makeALMSearchWidgetError(c,g){var d=getSearchWidgetByDOI(c);var e=d[0];var f=$("<span></span>");f.addClass("inlineError");f.css("display","none");f.html(g);$(e).find("span").fadeOut(250,function(){$(e).append(f);$(f).fadeIn(250)})}function confirmALMDataDisplayed(){if(confirmed_ids!=null){for(a=0;a<confirmed_ids.length;a++){for(b=0;b<ids.length;b++){if(confirmed_ids[a]==ids[b]){ids.remove(b)}}}}for(a=0;a<ids.length;a++){var c=$("li[data-doi='"+ids[a]+"']");var d=$(c[0]).data("pdate");if(d>((new Date().getTime())-172800000)){makeALMSearchWidgetError(ids[a],"Metrics unavailable for recently published articles. Please check back later.")}else{makeALMSearchWidgetError(ids[a],'<img src="../images/icon_error.png"/>&nbsp;Metrics unavailable. Please check back later.')}}};